<div id="{{ .modal.id }}" tabindex="-1" aria-hidden="true" class="hidden fixed top-0 right-0 left-0 z-50 flex justify-center items-center w-full h-screen">
    <div class="relative p-4 w-full max-w-3xl lg:max-w-6xl">
        <div class="relative bg-white rounded-lg shadow-lg">
            <div class="grid grid-cols-1 gap-5 lg:grid-cols-2">
                
                <!-- Image Section (Desktop Only) -->
                <div class="h-full hidden lg:block">
                    {{ partial "image-srcset.html" (dict "context" . "image" .modal.image "alt" .modal.title "object" "cover" "rounded" "rounded-lg" "srcset" (slice "600" "900" "1200")) }}
                </div>
                
                <!-- Form Section -->
                <div class="py-5 px-4 md:py-12 md:px-10">
                    <!-- Close Button -->
                    <button type="button" class="absolute top-2 right-2 text-gray-500 bg-transparent hover:bg-gray-200 hover:text-gray-700 rounded-full text-sm w-8 h-8 flex items-center justify-center transition lg:w-9 lg:h-9 xl:top-3 xl:right-3" data-modal-hide="{{ .modal.id }}">
                        <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                        </svg>
                        <span class="sr-only">Close modal</span>
                    </button>
                    
                    <!-- Logo (Mobile Only) -->
                    <img src="/images/logo_moyer-realty-services.svg" width="390" height="99" alt="{{ site.Title }} logo" class="mx-auto mb-7 h-[60px] lg:hidden" loading="lazy">

                    <!-- Title -->
                    <h3 class="text-heading-4 mb-4 text-center lg:text-left">{{ .modal.title }}</h3>

                    <!-- Form -->
                    <form action="{{ .modal.form_action }}" method="POST">
                        <div class="grid gap-4 grid-cols-2">
                            
                            <!-- Dynamic Fields -->
                            {{ range .modal.fields }}
                                {{ if eq .type "hidden" }}
                                    <input type="hidden" name="{{ .name }}" value="{{ if .url }}{{ site.BaseURL }}{{ end }}{{ .value }}">
                                {{ else if eq .type "honeypot" }}
                                    <input type="checkbox" name="{{ .id }}" tabindex="-1" autocomplete="off">
                                {{ else }}
                                    <div class="col-span-2 {{ if not .full_width }} md:col-span-1 {{ end }}">
                                        {{ if .label }}
                                            <label for="{{ .id }}" class="block mb-2 font-bold text-gray-700">{{ .label }}</label>
                                        {{ end }}
                                        {{ if eq .type "textarea" }}
                                            <textarea name="{{ .id }}" id="{{ .id }}" rows="{{ .rows }}" class="bg-gray-50 border border-gray-300 rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5" placeholder="{{ .placeholder }}" required></textarea>
                                        {{ else if or (eq .type "text") (eq .type "email") (eq .type "tel") }}
                                            <input type="{{ .type }}" name="{{ .id }}" id="{{ .id }}" class="bg-gray-50 border border-gray-300 rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5" placeholder="{{ .placeholder }}" required>
                                        {{ else if eq .type "select" }}
                                            <select name="{{ .id }}" id="{{ .id }}" class="bg-gray-50 border border-gray-300 rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5" aria-label="{{ .placeholder }}">
                                                <option selected>{{ .placeholder }}</option>
                                                {{ range .options }}
                                                    <option value="{{ . | urlize }}">{{ . }}</option>
                                                {{ end }}
                                            </select>
                                        {{ end }}
                                    </div>
                                {{ end }}
                            {{ end }}

                            <!-- reCAPTCHA -->
                            <div class="col-span-2 mb-4">
                                <div class="g-recaptcha" data-sitekey="{{ site.Params.recaptcha_key }}" data-callback="enableSubmitButton{{ .modal.id | safeJS }}" data-expired-callback="recaptchaExpired{{ .modal.id | safeJS }}"></div>
                                <div id="recaptcha-error-{{ .modal.id }}" class="text-red-500 text-sm hidden">Please complete the reCAPTCHA</div>
                            </div>

                            <!-- Submit Button -->
                            <div class="col-span-2">
                                <button type="submit" class="btn btn-submit-{{ .modal.id }} btn-solid btn-arrow btn-primary w-full mb-2" disabled>
                                    {{ .modal.button_text }}
                                </button>
                                <div class="italic text-sm text-gray-600">Your information is safe and secure with us.</div>
                            </div>
                        </div>
                    </form>

                    <!-- JavaScript for reCAPTCHA Validation -->
                    <script>
                        function getButtonSelector(modalId) {
                            return '.btn-submit-' + modalId;
                        }

                        window.enableSubmitButton = function(response, modalId) {
                            if (!response) {
                                console.warn('No reCAPTCHA response token received');
                                return;
                            }
                            const submitButton = document.querySelector(getButtonSelector(modalId));
                            if (submitButton) {
                                submitButton.removeAttribute('disabled');
                            } else {
                                console.warn('Submit button not found for modal:', modalId);
                            }
                        };

                        window.recaptchaExpired = function(modalId) {
                            const submitButton = document.querySelector(getButtonSelector(modalId));
                            if (submitButton) {
                                submitButton.setAttribute('disabled', 'disabled');
                            } else {
                                console.warn('Submit button not found for modal:', modalId);
                            }
                        };

                        (function() {
                            var modalId = '{{ .modal.id | safeJS }}';
                            window['enableSubmitButton' + modalId] = function(response) {
                                window.enableSubmitButton(response, modalId);
                            };
                            window['recaptchaExpired' + modalId] = function() {
                                window.recaptchaExpired(modalId);
                            };
                        })();
                    </script>
                </div>
            </div>        
        </div>
    </div>
</div>
